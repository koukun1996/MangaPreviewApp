# マンガプレビューアプリ

FANZA APIから取得した漫画データを活用し、MongoDB上でデータを管理するSPA（Single Page Application）です。

## システム概要

このアプリケーションは以下の主要機能を提供します：

1. **漫画データの取得と表示**
   - FANZA APIから漫画データを取得
   - MongoDBに保存されたデータをブラウザに表示
   - 漫画のサムプル画像閲覧

2. **検索機能**
   - タイトル、作者、タグによる検索
   - 組み合わせ検索機能

3. **SEO最適化**
   - 動的ページ生成によるロングテールSEO対策
   - サーバーサイドレンダリング（SSR）対応

## 技術スタック

- **フロントエンド**: Angular 16
- **バックエンド**: Node.js, Express
- **データベース**: MongoDB
- **SSR**: Angular Universal
- **APIデータソース**: FANZA API

## 開発計画

### フェーズ1: 基本機能の実装（完了）
- ✅ プロジェクトの基本構造の構築
- ✅ 漫画表示コンポーネントの実装
- ✅ APIとの接続とデータ取得機能
- ✅ MongoDBへのデータ保存機能
- ✅ ダミーデータ生成とテスト機能

### フェーズ2: 日次データ更新処理（現在）
- ⬜ FANZAデータ取得バッチ処理の実装
- ⬜ クロンジョブスケジューラの設定
- ⬜ データの重複チェックと更新ロジック
- ⬜ エラーハンドリングと再試行メカニズム
- ⬜ ログ出力と監視機能

### フェーズ3: SEO最適化（予定）
- ⬜ 動的ページ生成のためのルーティング構造
- ⬜ メタデータの動的生成
- ⬜ サイトマップ自動生成機能
- ⬜ パフォーマンス最適化
- ⬜ 検索エンジンへのインデックス登録

### フェーズ4: UI/UX改善（予定）
- ⬜ レスポンシブデザインの強化
- ⬜ 直感的なナビゲーション改善
- ⬜ ダークモード対応
- ⬜ アクセシビリティの向上
- ⬜ PWA対応

## データ更新バッチ処理設計

FANZA APIからデータを取得し、MongoDBに保存する日次バッチ処理の流れ：

1. **初期化**：環境変数とAPI認証設定の読み込み
2. **API呼び出し**：FANZA APIから最新の漫画データを取得
3. **データ加工**：取得したデータをMongoDB形式に変換
4. **差分抽出**：既存データとの比較による差分抽出
5. **更新処理**：新規データの挿入と既存データの更新
6. **インデックス最適化**：検索パフォーマンス向上のためのインデックス管理
7. **ログ出力**：処理結果とエラー情報の記録

## 動的ページ生成の仕組み

SEO対策としての動的ページ生成フロー：

1. リクエスト受信
2. URLパラメータ解析
3. MongoDBからデータ取得
4. メタデータ動的生成
5. SSRによるHTML生成
6. クライアントへのレスポンス

## ローカル環境セットアップ

```bash
# リポジトリのクローン
git clone https://github.com/yourusername/manga-preview-app.git
cd manga-preview-app

# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev:ssr

# ダミーデータの生成
npm run generate-dummy-data
```

## デプロイ方法

```bash
# 本番ビルド
npm run build:ssr:prod

# サーバー起動
npm run serve:ssr

# PM2によるプロセス管理
npm run pm2:start
```

## API仕様

### FANZA APIエンドポイント

```
https://api.dmm.com/affiliate/v3/ItemList
```

必要なパラメータ:
- api_id: APIのID
- affiliate_id: アフィリエイトID
- site: 'FANZA'
- service: 'digital'
- floor: 'comic'
- hits: 取得数
- offset: 開始位置

## コントリビューション

プルリクエストは歓迎です。大きな変更を行う場合は、まずissueを作成して議論してください。

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。